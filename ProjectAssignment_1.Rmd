---
title: "Reproducible Research: Peer Assessment 1"
author: "Alberto A. Caeiro Jr"
output: 
  html_document:
    keep_md: true
---
This project is part of the Johns Hopkins University, offered by Coursera.


### Setting Working Folder
```{r}
setwd('/Users/acaeiro/Developer/Data Science Specialization/RepData_PeerAssessment1')
```

### Loading and preprocessing the data
The dataset is zipped, so we have to unzip it and then load into R.

```{r}
zipFile <- "./activity.zip"
fileList <- unzip(zipFile)
activity <- read.csv(fileList[1], sep=",", header=TRUE)
```

The date column needs to be reformatted to DATE format.
```{r}
activity$date <- as.Date(activity$date, format="%Y-%m-%d")
str(activity)
```

## What is mean total number of steps taken per day?

1. Total numbers of steps taken Each Day (Hist)
```{r} 
byValue=list(Date = activity$date)
SumOfSteps <- aggregate(activity$steps, by=byValue, FUN=sum, na.rm=TRUE)
names(SumOfSteps) <- c("Date", "Sum.Of.Steps")
with(SumOfSteps, hist(Sum.Of.Steps, col=Date, xlab="Total Steps per Day", main="Total Steps"))

```

2. Mean total number of steps
```{r}
byValue=list(Date = activity$date)
meanOfSteps <- aggregate(activity$steps, by=byValue, FUN=mean, na.rm=TRUE)
names(meanOfSteps) <- c("Date", "Average.Of.Steps")
with(meanOfSteps, plot(Date, Average.Of.Steps, ylab="Mean - Daily Total Steps", type="l", 
                       main="Average - Steps by Day"))
```

3. Median total number of steps
```{r}
byValue=list(Date = activity$date)
medianOfSteps <- aggregate(activity$steps, by=byValue, FUN=median, na.rm=TRUE)
names(medianOfSteps) <- c("Date", "Median.Of.Steps")
with(medianOfSteps, plot(Date, Median.Of.Steps, type="l", ylab="Median - Daily Total Steps", 
                               main="Median - Steps by Day"))
```
It makes any sense the median = 0?

## What is the average daily activity pattern?
4. Make a time series plot (i.e. type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)
```{r}
byValue=list(TimeInterval = activity$interval)
stepsByInterval <- aggregate(activity$steps, by=byValue, FUN=mean, na.rm=TRUE)
names(stepsByInterval) <- c("Interval", "Mean.Of.Steps")
with(stepsByInterval, plot(Interval, Mean.Of.Steps, type="l", xlab="5 Min Interval", ylab="Average Steps", 
                               main="Average Steps by 5 Min Interval"))
```

5. Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?
```{r}
t <- cbind(stepsByInterval$Mean.Of.Steps, stepsByInterval$Interval)
colnames(t) <- c("Mean Of Steps", "5 min Interval")
maxNumOfSteps <- max(t[,1])
intervalOfMaxSteps <- t[(t[,1] == maxNumOfSteps),][2]
print(intervalOfMaxSteps)
```

## Imputing missing values
6. Counting and Reporting the number of NA in the dataset
```{r}
sum(is.na(activity$steps))
```
and it represents in % of the sampling...
```{r}
mean(is.na(activity$steps))
```

7. The strategy for filling in missing values will be to use the mean of the day.
In case of the mean == NaN, 0 will be used instead.
Here you can find the mean of steps by day (only the first 20, for reference)
```{r}
head(meanOfSteps, n=35)
```

8. Create a new dataset that is equal to the original dataset but with the missing data filled in.
```{r}
complDataset <- split(activity,factor(activity$date))
numOfIntervals <- length(complDataset[[1]]$steps)
numOfDays <- length(meanOfSteps$Average.Of.Steps)
for (i in numOfDays) {
    for( j in numOfIntervals) {
        if (is.na(complDataset[[i]]$steps[j])) {
            if (is.nan(meanOfSteps$Average.Of.Steps[i])) {
                complDataset[[i]]$steps[j] <- 0
            } else {
                complDataset[[i]]$steps[j] <- meanOfSteps$Average.Of.Steps[i]
            }
            
        }
    }
}
```
PAREI AQUI!!!!
Considering this new dataset, let's check itens 1, 2 and 3 to see what are the changes.
Total Steps.
```{r}
byValue=list(Date = complDataset$date)
SumOfSteps <- aggregate(complDataset$steps, by=byValue, FUN=sum, na.rm=TRUE)
names(SumOfSteps) <- c("Date", "Sum.Of.Steps")
with(SumOfSteps, hist(Sum.Of.Steps, col=Date, xlab="Total Steps per Day", main="Total Steps"))

```

Average Steps
```{r}
byValue=list(Date = complDataset$date)
meanOfSteps <- aggregate(complDataset$steps, by=byValue, FUN=mean, na.rm=TRUE)
names(meanOfSteps) <- c("Date", "Average.Of.Steps")
with(meanOfSteps, plot(Date, Average.Of.Steps, ylab="Mean - Daily Total Steps", type="l", 
                       main="Average - Steps by Day"))
```

Median
```{r}
byValue=list(Date = complDataset$date)
medianOfSteps <- aggregate(complDataset$steps, by=byValue, FUN=median, na.rm=TRUE)
names(medianOfSteps) <- c("Date", "Median.Of.Steps")
with(medianOfSteps, plot(Date, Median.Of.Steps, type="l", ylab="Median - Daily Total Steps", 
                               main="Median - Steps by Day"))
```

## Are there differences in activity patterns between weekdays and weekends?
Creating a new variable for holding info about weekdays/weekends
```{r}
complDataset <- activity
complDataset$weekday <- factor(weekdays(complDataset$date), levels=c("weekday", "weekend"))
for (i in 1:length(complDataset$date)){
    if (weekdays(complDataset$date[i]) %in% c("Saturday", "Sunday")) {
        complDataset$weekday[i] <- "weekend"
    } else {
        complDataset$weekday[i] <- "weekday"
    }
}
```